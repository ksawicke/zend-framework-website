<style media="screen" type="text/css">
.row {
  margin-top: 0px;
  margin-bottom: 15px
}
</style>

<div class="row gutter-10">
    <div class="col-md-6 col-lg-6">
      <h4>Review Request <?php echo $timeoffRequestData['REQUEST_ID']; ?></h4>
    </div>
    <div class="col-md-6 col-lg-6 text-right">
      <a href="<?php echo $this->basePath() . $viewQueueLink; ?>">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
      </a>
    </div>
</div>

<br />

<div class="row">
    <div class="col-lg-12 col-md-12">
        <div class="panel panel-default">

            <div class="panel-heading clearfix">
                <i class="icon-calendar"></i>
                <h3 class="panel-title">Request for</h3>
            </div>

            <div class="panel-body">

                <div class="row">
                    <div class="col-lg-12 col-md-12">

                        <?php /*** BEGIN REQUEST FOR ***/ ?>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Name</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo $timeoffRequestData['EMPLOYEE_DATA']->EMPLOYEE_DESCRIPTION_ALT; ?>&nbsp;-&nbsp;<?php echo $timeoffRequestData['POSITION_TITLE']; ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Email Address</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo strtolower( $timeoffRequestData['EMPLOYEE_DATA']->EMAIL_ADDRESS ); ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Supervisor</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo $timeoffRequestData['EMPLOYEE_DATA']->MANAGER_DESCRIPTION_ALT; ?>&nbsp;-&nbsp;<?php echo $timeoffRequestData['EMPLOYEE_DATA']->MANAGER_POSITION_TITLE; ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Schedule</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <table class="employeeSchedule">
                                    <thead>
                                        <tr>
                                            <th>SUN</th>
                                            <th>MON</th>
                                            <th>TUE</th>
                                            <th>WED</th>
                                            <th>THU</th>
                                            <th>FRI</th>
                                            <th>SAT</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_SUN, 2); ?></td>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_MON, 2); ?></td>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_TUE, 2); ?></td>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_WED, 2); ?></td>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_THU, 2); ?></td>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_FRI, 2); ?></td>
                                            <td><?php echo number_format($timeoffRequestData->SCHEDULE_SAT, 2); ?></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Hire Date</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo $timeoffRequestData['EMPLOYEE_HIRE_DATE']; ?>
                            </div>
                        </div>
                        <?php /*** END REQUEST FOR ***/ ?>

                    </div>
                </div>

            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 col-md-12">
        <div class="panel panel-default">

            <div class="panel-heading clearfix">
                <i class="icon-calendar"></i>
                <h3 class="panel-title">Requested by</h3>
            </div>

            <div class="panel-body">

                <div class="row">
                    <div class="col-lg-12 col-md-12">

                        <?php /*** BEGIN REQUESTED BY ***/ ?>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Name</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo $timeoffRequestData['CREATOR_FIRST_NAME']; ?>&nbsp;<?php echo $timeoffRequestData['CREATOR_LAST_NAME']; ?>&nbsp;(<?php echo $timeoffRequestData['CREATE_USER']; ?>)&nbsp;-&nbsp;<?php echo $timeoffRequestData['CREATOR_POSITION_TITLE']; ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Email Address</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo strtolower( $timeoffRequestData['CREATOR_EMAIL_ADDRESS'] ); ?>
                            </div>
                        </div>
                        <?php /*** END REQUESTED BY ***/ ?>

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 col-md-12">
        <div class="panel panel-default">

            <div class="panel-heading clearfix">
                <i class="icon-calendar"></i>
                <h3 class="panel-title">Request Details</h3>
            </div>

            <div class="panel-body">

                <div class="row">
                    <div class="col-lg-12 col-md-12">

                        <?php /*** BEGIN REQUEST DETAIL ***/ ?>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Status</strong>
                            </div>
                            <div class="col-lg-10 col-md-10" id="reviewRequestStatus">
                                <?php echo $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']; ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Total Hours Requested</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <?php echo ( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']!="Denied" ?
                                             $totalHoursRequested . ' hr' . ( ( $totalHoursRequested > 1 ) ? 's' : '' ) :
                                             'n/a' ); ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Reason</strong>
                            </div>
                            <div class="col-lg-10 col-md-10 breakLongWordDiv">
                                <?php echo $timeoffRequestData['REQUEST_REASON']; ?>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Time Off Requested</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                              <?php if( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']!="Denied" ) {
                                        echo $this->partial( 'request/partials/categoryButtonsWidget.phtml' );
                      echo $this->partial( 'request/partials/oneCalendarWidget.phtml' );
                      echo $this->partial( 'request/partials/managerEditRequestFormWidget.phtml', [ 'isBeingReviewed' => 'Y' ] );
                                    } else {
                                        ?>

                                        <div id="deniedRequestFlashMessage" class="alert alert-info" role="alert">
                                               <i class="fa fa-info"></i> <strong>Denied requests can no longer be edited.</strong>
                                          </div>

                                        <?php
                                    }
                  ?>
                            </div>
                        </div>

                        <?php /*****************************/ ?>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>Time Off Hours</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">

                                <table class="employeeSchedule">
                                    <thead>
                                        <tr>
                                            <th>&nbsp;</th>
                                            <th>Grandfathered</th>
                                            <th>PTO</th>
                                            <th>Float</th>
                                            <th>Sick</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Pending</td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->GF_PENDING_TOTAL, 2 ); ?></td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->PTO_PENDING_TOTAL, 2 ); ?></td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->FLOAT_PENDING_TOTAL, 2 ); ?></td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->SICK_PENDING_TOTAL, 2 ); ?></td>
                                        </tr>
                                        <tr>
                                            <td>Remaining</td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->GF_REMAINING, 2 ); ?></td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->PTO_REMAINING, 2 ); ?></td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->FLOAT_REMAINING, 2 ); ?></td>
                                            <td><?php echo number_format( $timeoffRequestData['EMPLOYEE_DATA']->SICK_REMAINING, 2 ); ?></td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                        <?php /*****************************/ ?>

                        <div class="row">
                            <div class="col-lg-2 col-md-2 text-right">
                                <strong>History</strong>
                            </div>
                            <div class="col-lg-10 col-md-10">
                                <table class="employeeSchedule">
                                    <?php /*** <thead>
                                        <tr>
                                            <th>COMMENT</th>
                                        </tr>
                                    </thead> ***/ ?>
                                    <tbody>
                                        <?php
                                        foreach( $timeoffRequestData['LOG_ENTRIES'] as $ctr => $entry ) {
                                            echo '<tr>';
                                            echo '<td' . ( $entry['COMMENT_TYPE']=="P" ? ' class="payrollComment"' : '') . '>' .
                                                 $entry['CREATE_TIMESTAMP'] . ' - ' . $entry['COMMENT'] .
                                                 ( $entry['COMMENT_TYPE']=="P" ? '&nbsp;&nbsp;&nbsp;' .
                                                   '<button type="button" class="btn btn-form-primary btn-xs payrollEditPayrollComment" ' .
                                                   ' data-payroll-request-log-id="' . $entry['REQUEST_LOG_ID'] . '">Edit</button>' .
                                                   '<div style="display:none;" data-payroll-comment-wrapper-id="' . $entry['REQUEST_LOG_ID'] . '"><br />' .
                                                   '<span style="font-weight:normal;color:#000;">Edit Payroll Comment:<br />' .
                                                   '<textarea maxlength="500" rows="4" cols="80" data-payroll-comment-text-id="' . $entry['REQUEST_LOG_ID'] . '">' .
                                                   $entry['COMMENT'] .
                                                   '</textarea></span><br />' .
                                                   '<button type="button" class="btn btn-form-primary btn-xs payrollSavePayrollComment" ' .
                                                   ' data-payroll-request-log-id="' . $entry['REQUEST_LOG_ID'] . '">Save</button>' .
                                                   '</div>' : '' ) .
                                                 '</td>';
                                            echo '</tr>';
                                        }
                                        ?>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <?php if( ( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Pending Manager Approval" ||
                                    $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Pending Payroll Approval" ||
                                    $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Update Checks" ||
                                    ( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Completed PAFs" && $$isPayroll=="Y" )
                                ) &&
                                  $timeoffRequestData['EMPLOYEE_NUMBER']!==$loggedInEmployeeNumber ) {
                        ?>
                        <div class="form-group">
                            <label for="inputPassword3" class="col-lg-2 col-md-2 text-right">Approval Actions</label>
                            <div class="ccol-lg-10 col-md-10">
                                <?php /**if( $isPayrollReviewRequired && $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']!="Pending Payroll Approval" ) { ?>
                                <div class="alert alert-danger" role="alert">
                                    <i class="fa fa-exclamation-circle"></i> <strong>Payroll Approval Required</strong><br /><br />
                                    This request exceeded the employee's remaining time in certain category/ies and requires Payroll Approval.
                                </div>
                                <?php }**/ ?>

                                <?php
//                                $buttonDisabled = "";
//                                if( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']!="Pending Manager Approval" ) {
//                                    $buttonDisabled = " disabled";
//                                }
                                ?>
                                <div id="noCommentEnteredWarning" class="hidden">
                                    <div class="alert alert-danger" role="alert">
                                        <strong>A comment is required before proceeding with this action.</strong>
                                    </div>
                                </div>
                                <input type="hidden" id="requestId" value="<?php echo $timeoffRequestData['REQUEST_ID']; ?>">

                                <p>
                                    <?php if( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Pending Manager Approval" &&
                                              $timeoffRequestData['EMPLOYEE_NUMBER']!==$loggedInEmployeeNumber ) { ?>
                                        <textarea maxlength="500" rows="4" cols="80" id="managerComment" name="managerComment"></textarea>
                                        <br />
                                        <button type="button" class="btn btn-form-primary apiRequest" data-apiaction="managerActionApproveRequest">Approve</button>
                                        <button type="button" class="btn btn-form-primary apiRequest" data-apiaction="managerActionDenyRequest">Deny</button>
                                    <?php } ?>

                                    <?php if( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Pending Payroll Approval" &&
                                              $timeoffRequestData['EMPLOYEE_NUMBER']!==$loggedInEmployeeNumber ) { ?>
                                        <textarea maxlength="500" rows="4" cols="80" id="payrollComment" name="payrollComment"></textarea>
                                        <br />
                                        <button type="button" class="btn btn-form-primary apiRequest" data-apiaction="payrollActionApproveRequest">Approve</button>
                                        <button type="button" class="btn btn-form-primary apiRequest" data-apiaction="payrollActionDenyRequest">Deny</button>
                                        <?php /**<button type="button" class="btn btn-form-primary apiRequest" data-apiaction="payrollActionUpload">Upload</button>**/ ?>
                                        <button type="button" class="btn btn-form-primary apiRequest" data-apiaction="payrollActionUpdateOfficeChecks">Update Checks</button>
                                    <?php } ?>

                                    <?php if( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Update Checks" &&
                                              $timeoffRequestData['EMPLOYEE_NUMBER']!==$loggedInEmployeeNumber ) { ?>
                                        <button type="button" class="btn btn-form-primary apiRequest" data-request-id="<?php echo $timeoffRequestData['REQUEST_ID']; ?>" data-apiaction="payrollActionCompleteRequest">Approve</button>
                                    <?php } ?>

                                    <?php if( $timeoffRequestData['REQUEST_STATUS_DESCRIPTION']=="Completed PAFs" &&
                                              $timeoffRequestData['EMPLOYEE_NUMBER']!==$loggedInEmployeeNumber &&
                                              $$isPayroll=="Y" ) { ?>
                                        <textarea maxlength="500" rows="4" cols="80" id="payrollComment" name="payrollComment"></textarea>
                                        <br />
                                        <button type="button" class="btn btn-form-primary apiRequest" data-request-id="<?php echo $timeoffRequestData['REQUEST_ID']; ?>" data-apiaction="payrollActionSaveChangesToCompletedRequest">Save</button>
                                    <?php } ?>
                                </p>
                            </div>
                        </div>
                        <?php } /*** BEGIN REQUEST DETAIL ***/ ?>

                    </div>
                </div>

            </div>

        </div>
    </div>
</div>

<?php echo $this->partial( 'request/partials/dialogConfirmSelectHolidayAlertWidget.phtml' ); ?>

<script type="text/javascript" src="<?php echo $this->basepath(); ?>/js/select2/select2.min.js"></script>
<script type="text/javascript" src="<?php echo $this->basepath(); ?>/js/request/timeOffApproveRequestHandler.js"></script>
<script type="text/javascript" src="<?php echo $this->basepath(); ?>/js/request/timeOffApproveRequestInitHandler.js"></script>

<?php
// $timeoffRequestData['EMPLOYEE_DATA']
$phpVars = [ 'logged_in_employee_number' => \Login\Helper\UserSession::getUserSessionVariable( 'EMPLOYEE_NUMBER' ),
             'employee_number' => $timeoffRequestData['EMPLOYEE_DATA']->EMPLOYEE_NUMBER,
             'basePath' => ( ENVIRONMENT==='development' || ENVIRONMENT==='testing' ?
                             'http://swift:10080' . $this->basepath() :
                             'http://aswift:10080' . $this->basepath() ),
             'request_id' => $timeoffRequestData['REQUEST_ID']
            ];

$this->headScript()->prependScript( 'var phpVars=' . json_encode( $phpVars ) );
